@import "shared-styles";

@keyframes bar-grass-wave {
    0% {
        transform: scaleY(0.99) skewX(-1deg);
    }

    25% {
        transform: scaleY(1.01) skewX(0);
    }

    50% {
        transform: scaleY(0.99) skewX(1deg);
    }

    75% {
        transform: scaleY(1.01) skewX(0);
    }
  
    100% {
        transform: scaleY(1.0) skewX(-1deg);
    }
}

@keyframes grass-wave {
    from {
        transform: scale(0.95, 1.05);
    }
  
    to {
        transform: scale(1.05, 0.95);
    }
}

:host {
    --battle-field-y: min(118.076vw, 65.7vh);
    background-image: linear-gradient(180deg, #9EC7F3 0, #2CF0EA 53.846%);
}

.score-bar {
    --bar-width: min(77.69vw, 33.33vh);
    display: flex;

    &::before {
        content: '';
        width: var(--bar-width);
        height: calc(var(--bar-width) / 5.05);
        background-image: var(--game-score-bar);
        position: absolute;
        left: 5.38vw;
    }

    .remaining-steps {
        --shadow-color: #4a321a;
        --shadow-depth: min(0.11vw, 1px);
        --height: calc(var(--bar-width) * 0.2211);
        width: calc(var(--bar-width) * 0.23471);
        height: var(--height);
        display: flex;
        align-items: center;
        justify-content: center;
        background-image: var(--game-remaining-steps);
        position: absolute;
        font-size: calc(var(--bar-width) * 0.09);
        padding: 0 0 calc(var(--height) * 0.14) calc(var(--height) * 0.14);
        @include text-border(var(--shadow-color), var(--shadow-depth));
        left: 0;
    }

    .stop-continue {
        --width: calc(var(--bar-width) * 0.1834);
        width: var(--width);
        height: calc(var(--width) * 1.15338);
        background-image: var(--game-stop-continue);
        position: absolute;
        right: calc(var(--width) * 0.1);
    }
}

.bar,
.chessboard,
.battle-field .grass {
    @extend %layer;
}

.bar {
    --width: min(155.6vw, 91vh);
    --bar-width: var(--width);
    --bar-height: calc(var(--width) * 0.08649);
    height: var(--bar-height);
    display: flex;
    justify-content: center;
    position: absolute;
    bottom: calc(var(--battle-field-y) - var(--bar-height) * 0.92);
    z-index: 1;

    &::before,
    &::after,
    .bar-lamp {
        content: '';
        @include size(100%);
        position: absolute;
        left: 0;
    }

    &::before {
        height: 128.5%;
        transform-origin: center top;
        animation: bar-grass-wave 4s infinite alternate-reverse linear;
        background-image: var(--game-bar-grass);
        top: 48%;
    }

    &::after {
        background-image: var(--game-bar-wood);
        top: 0;
    }

    .bar-lamp {
        height: calc(var(--bar-width) * 0.08749);
        background-image: var(--game-bar-lamp);
        z-index: 1;
        top: 13%;
    }

    .hint-board {
        --board-width: calc(var(--bar-width)* 0.346);
        --board-height: calc(var(--board-width) * 0.2738);
        --padding-top: calc(var(--board-width) * 0.07857);
        --padding-bottom: calc(var(--board-width) * 0.0571);
        @include size(var(--board-width), var(--board-height));
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        align-items: center;
        background-image: var(--game-hint-board);
        margin-top: calc(0px - var(--bar-width) * .01);
        padding: var(--padding-top) calc(var(--board-width) * 0.0619) var(--padding-bottom);
        z-index: 1;

        .fruit {
            --shadow-color: #4a321a;
            --fruit-size: calc(var(--board-height) - var(--padding-top) - var(--padding-bottom));
            
            &::before {
                --shadow-depth: min(0.3vw);
                @include drop-border(var(--shadow-color), var(--shadow-depth));
            }

            &::after {
                --shadow-depth-font: min(0.11vw, 1px);
                content: attr(count);
                margin-left: calc(var(--fruit-size) * 0.2);
                margin-top: 15%;
                font-size: calc(var(--board-width) * 0.05);
                @include text-border(var(--shadow-color), var(--shadow-depth-font));
            }
        }
    }
}

.fruit {
    @include size(var(--fruit-size), var(--fruit-size), true);
    max-width: var(--fruit-size);
    max-height: var(--fruit-size);
    display: flex;
    align-items: center;

    &::before {
        content: '';
        @include size(var(--fruit-size), var(--fruit-size), true);
        background-image: var(--icon-fruit);
        background-size: contain;
    }

    &.blurberry {
        --icon-fruit: var(--game-blurberry);
    }

    &.leechee {
        --icon-fruit: var(--game-leechee);
    }

    &.melon {
        --icon-fruit: var(--game-melon);
    }

    &.mongo {
        --icon-fruit: var(--game-mongo);
    }

    &.strawberry {
        --icon-fruit: var(--game-strawberry);
    }

    &.yogurt {
        --icon-fruit: var(--game-yogurt);
    }
}

.battle-field {
    @include size(100%, var(--battle-field-y));
    background-image: var(--game-battle-field);
    position: absolute;
    bottom: 0;

    .chessboard {
        --columns: 8;
        --rows: 7;
        --cell-size: 8vw;
        --chessboard-width: calc(var(--cell-size) * var(--columns));
        --chessboard-height: calc(var(--cell-size) * var(--rows));
        --width: var(--chessboard-width);
        height: var(--chessboard-height);
        display: grid;
        grid-template-columns: repeat(var(--columns), var(--cell-size));
        grid-template-rows: repeat(var(--rows), var(--cell-size));
        top: calc(50% - var(--chessboard-height) / 2);

        .fruit {
            background-color: #D9B478;

            &.disable {
                opacity: 0;

                &:nth-of-type(1),
                &:nth-of-type(5),
                &:nth-of-type(7),
                &:nth-of-type(9) {
                    grid-column: 1;
                }

                &:nth-of-type(4),
                &:nth-of-type(6),
                &:nth-of-type(8),
                &:nth-of-type(12) {
                    grid-column: var(--columns);
                }

                &:nth-of-type(2),
                &:nth-of-type(10) {
                    grid-column: 2;
                }

                &:nth-of-type(3),
                &:nth-of-type(11) {
                    grid-column: calc(var(--columns) - 1);
                }

                &:nth-of-type(1),
                &:nth-of-type(2),
                &:nth-of-type(3),
                &:nth-of-type(4) {
                    grid-row: 1;
                }

                &:nth-of-type(9),
                &:nth-of-type(10),
                &:nth-of-type(11),
                &:nth-of-type(12) {
                    grid-row: var(--rows);
                }

                &:nth-of-type(5),
                &:nth-of-type(6) {
                    grid-row: 2;
                }

                &:nth-of-type(7),
                &:nth-of-type(8) {
                    grid-row: calc(var(--rows) - 1);
                }
            }
        }
    }

    .grass {
        --height: min(28.917vw, 12vh);
        --width: 100vw;
        --grass-width: var(--width);
        height: var(--height);
        display: flex;
        align-items: flex-end;
        justify-content: center;
        background-image: var(--game-grass);
        background-position: center top;
        position: absolute;
        padding-bottom: calc(var(--grass-width) * 0.032301);
        bottom: 0;

        &::before,
        &::after {
            content: '';
            position: absolute;
            z-index: 1;
            transform-origin: center bottom;
            animation: grass-wave 3s infinite alternate-reverse;
        }

        &::before {
            --bottom-grass-width: min(calc(var(--grass-width) * 0.32179), 17vh);
            @include size(var(--bottom-grass-width), calc(var(--bottom-grass-width) * 0.8));
            background-image: var(--game-grass-bottom-left);
            left: -0.8%;
        }

        &::after {
            --bottom-grass-width: min(calc(var(--grass-width) * 0.1192), 6.3vh);
            @include size(var(--bottom-grass-width), calc(var(--bottom-grass-width) * 1.8));
            background-image: var(--game-grass-bottom-right);
            right: -0.8%;
        }

        .tool {
            --tool-size: calc(var(--height) * 0.594);
            content: '';
            @include size(var(--tool-size), var(--tool-size), true);
            position: relative;
            z-index: 1;

            &.plier {
                --tool-icon: var(--game-plier);
            }

            &.air-blower {
                --tool-icon: var(--game-air-blower);
                margin: 0 15%;
            }

            &.rabbler {
                --tool-icon: var(--game-rabbler);
            }

            &::before,
            &::after {
                content: '';
                @include size(100%);
                position: absolute;
                z-index: 2;
            }

            &::before {
                background-image: var(--game-tool);
            }

            &::after {
                $color: #131313;
                $depth: 0.00001vw;
                background-image: var(--tool-icon);
                background-size: contain;
                filter:
                    drop-shadow(#{$depth} 0 0 #{$color})
                    drop-shadow(0 #{$depth} 0 #{$color})
                    drop-shadow(calc(0px - #{$depth}) 0 0 #{$color})
                    drop-shadow(0 calc(0px - #{$depth}) 0 #{$color})
                    drop-shadow(0.3vw 0.5vw 0.5px rgba($color, 0.84));
            }

            .shadow {
                content: '';
                @include size(165%, 96.731%);
                background-image: linear-gradient(101.79deg, #0D3A29 12.07%, rgba(13, 58, 41, 0) 65.51%);
                transform: rotate(55.76deg) translate(48%, 29%);
                position: absolute;
                z-index: 1;
            }
        }
    }
}
